<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>redis集群 | Gordo</title><meta name="keywords" content="linux,redis,缓存技术"><meta name="author" content="捕猹少年"><meta name="copyright" content="捕猹少年"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言官网 https:&#x2F;&#x2F;redis.io&#x2F; 1、安装1.1、工具和镜像文件本次使用虚拟机是VirtualBox，还可以使用vmware等虚拟机。   liunx镜像文件本次使用的是 CentOS-7-x86_64-DVD-1804.iso 版本，可以到CentOS的网站去下载；   xshell工具我这里选用的是Xmanager Enterprise 5的版本   redis镜像 可以从官网">
<meta property="og:type" content="article">
<meta property="og:title" content="redis集群">
<meta property="og:url" content="https://gitee.com/zhangyangibm/zhangyangibm.git/2020/07/24/redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="Gordo">
<meta property="og:description" content="前言官网 https:&#x2F;&#x2F;redis.io&#x2F; 1、安装1.1、工具和镜像文件本次使用虚拟机是VirtualBox，还可以使用vmware等虚拟机。   liunx镜像文件本次使用的是 CentOS-7-x86_64-DVD-1804.iso 版本，可以到CentOS的网站去下载；   xshell工具我这里选用的是Xmanager Enterprise 5的版本   redis镜像 可以从官网">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/zhangyangibm/zhangyangibm.git/img/redis.png">
<meta property="article:published_time" content="2020-07-23T16:00:00.000Z">
<meta property="article:modified_time" content="2022-03-18T05:20:41.678Z">
<meta property="article:author" content="捕猹少年">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="缓存技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/zhangyangibm/zhangyangibm.git/img/redis.png"><link rel="shortcut icon" href="/zhangyangibm/img/logo.png"><link rel="canonical" href="https://gitee.com/zhangyangibm/zhangyangibm.git/2020/07/24/redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/zhangyangibm/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/zhangyangibm/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'redis集群',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-18 13:20:41'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/zhangyangibm/img/header.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/zhangyangibm/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div><div class="data-item"><a href="/zhangyangibm/tags/"><div class="headline">标签</div><div class="length-num">37</div></a></div><div class="data-item"><a href="/zhangyangibm/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/zhangyangibm/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间抽</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/zhangyangibm/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/zhangyangibm/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/zhangyangibm/">Gordo</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/zhangyangibm/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间抽</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/zhangyangibm/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/zhangyangibm/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/zhangyangibm/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">redis集群</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-07-23T16:00:00.000Z" title="发表于 2020-07-24 00:00:00">2020-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-18T05:20:41.678Z" title="更新于 2022-03-18 13:20:41">2022-03-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/zhangyangibm/categories/%E6%96%87%E6%A1%A3/">文档</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/zhangyangibm/categories/%E6%96%87%E6%A1%A3/%E6%95%99%E7%A8%8B/">教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="redis集群"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><span id="more"></span>

<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>官网 <a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a><br><img src="/zhangyangibm/redis/0000.png" alt="Redis" title="Redis"></p>
<h3 id="1、安装"><a href="#1、安装" class="headerlink" title="1、安装"></a>1、安装</h3><h4 id="1-1、工具和镜像文件"><a href="#1-1、工具和镜像文件" class="headerlink" title="1.1、工具和镜像文件"></a>1.1、工具和镜像文件</h4><pre><code>本次使用虚拟机是VirtualBox，还可以使用vmware等虚拟机。  
liunx镜像文件本次使用的是 CentOS-7-x86_64-DVD-1804.iso 版本，可以到CentOS的网站去下载；  
xshell工具我这里选用的是Xmanager Enterprise 5的版本  
redis镜像 可以从官网上选用最新的版本，我这里使用的是 Redis-x64-3.2.100  本次使用版本是 redis-5.0.7.tar.gz
</code></pre>
<h4 id="1-2、前期准备"><a href="#1-2、前期准备" class="headerlink" title="1.2、前期准备"></a>1.2、前期准备</h4><pre><code>本机安装好虚拟机并且安装好linux，实现交互ping通互联网
1、进入到虚拟机 cd 进入 /usr/local/ 在local下新建一个文件夹 software 在software下新建文件夹redis。
2、上传redis镜像文件到 redis文件夹中 解压该文件 tar -xvf redis-5.0.7.tar.gz，完成后 该目录下会解压出一个文件夹  redis-5.0.7
3、因为redis是用c语言进行编写的，所有机器上要使用gcc进行编译，进入到解压目录（redis-5.0.7）
（1）、执行命令 yam install gcc 等待安装完毕
（2）、执行命令 gcc -v 会看到如下代码，说明安装成功
        [root@redis redis]# gcc -v
        使用内建 specs。
        COLLECT_GCC=gcc
（3）、执行命令 make 等待编译redis
    如果此时出现 jemalloc/jeamlloc.h 需要执行命令  make MALLOC = libc
（4）、编译成功之后就可以来安装redis了，命令
    # make install
    首先需要这样的操作：进入到redis解压目录 ..redis-5.0.7/src/
    a、执行命令 mkdir /home/bin 在home新建一个bin文件夹
    b、将以下redis文件移动至 /home/bin 下
        mv mkreleasehdr.sh redis-benchmark redis-check-aof redis-server redis-cli /home/bin/
    c、执行命令 mkdir /home/etc 在home目录下新建一个etc文件夹
    d、将文件移动到这文件夹
        mv redis.conf /home/src/
    e、vim修改 redis.conf 文件 将“daemonize no” 修改“daemonize yes” 这样修改的目的就是redis启动之后可以后台运行。
（5）、启动redis
    进入到home/bin目录 redis-server /home/bin/redis-config 控制台将会显示如下信息 Configuration loaded
    -----------
    2307:C 16 Feb 2020 10:47:14.810 # Redis version=5.0.7, bits=64, commit=00000000, modified=0, pid=2307, just started
    2307:C 16 Feb 2020 10:47:14.810 # Configuration loaded
    -----------
    ps -ef|grep redis 查看进程
    -----------
    [root@redis bin]# ps -ef|grep redis
    root      2222  1440  0 10:28 pts/0    00:00:00 mv -i redis-sentinel redis-server
    root      2308     1  0 10:47 ?        00:00:00 redis-server 127.0.0.1:6379
    root      2313  1440  0 10:47 pts/0    00:00:00 grep --color=auto redis
    -----------
    执行命令 redis-cli 进入redis环境

    以上redis一台服务器搭建完成
</code></pre>
<h4 id="1-3、集群搭建"><a href="#1-3、集群搭建" class="headerlink" title="1.3、集群搭建"></a>1.3、集群搭建</h4><pre><code>1、关闭防火墙
（1）、查看防火墙 firewall-cmd --zone=public --list-ports
    -----------
    [root@redis bin]# firewall-cmd --zone=public --list-ports 

    [root@redis bin]# 
    -----------
    此时防火墙正在运行
    （2）、关闭防火墙 systemctl stop firewalld.service 
    -----------
    [root@redis bin]# systemctl stop firewalld.service 
    [root@redis bin]# firewall-cmd --zone=public --list-ports 
    FirewallD is not running
    [root@redis bin]# 
    -----------
    此时提示信息“FirewallD is not running” 说明防护墙关闭
2、集群模型
    一个master主节点，两个从节点slave rds1和rds2
    此时需要是各个机器之间可以通信。
    三台机器同时进行 进入目录 cd /home/etc/ 完成后 新建文件夹 
        mkdir redis
        mkdir -p cluster
    进行如下操作 还是在当前文件夹（/home/etc/），三台机器分别执行
        第一台
        mkdir -p 7001
        mkdir -p 7004
        复制redis-config 到 7001和7004
        cp /home/etc/redis.config /home/redis/cluster/7001
        cp /home/etc/redis.config /home/redis/cluster/7004

        进入7001 ls查看文件 分别修改 vim redis.conf 配置
        a、daemonize=yes 开启后台运行
        b、port = 7001 运行端口
        c、dir=/home/redis/cluster/7004/ redis文件存放位置
        d、cluster-enabled=yes 是否开启集群模式
        e、appendnoly=yes 持久化
        f、protected-mode=no 保护模式
        g、requirepass=zhyredis 密码
        h、masterauth zhyredis 集群通信密码
        i、cluster-config-file nodes-7001.conf
        j、bind 注释

        第二台
        mkdir -p 7002
        mkdir -p 7005
        把第一台配置好的文件 抽取到本台虚拟机，命令：
        scp root@192.168.0.80:/home/redis/cluster/7001/redis.conf /home/redis/cluster/7002
        scp root@192.168.0.80:/home/redis/cluster/7001/redis.conf /home/redis/cluster/7005
        依次对应修改先关的配置文件


        第三台
        mkdir -p 7003
        mkdir -p 7006
        把第一台配置好的文件 抽取到本台虚拟机，命令：
        scp root@192.168.0.80:/home/redis/cluster/7001/redis.conf /home/redis/cluster/7003
        scp root@192.168.0.80:/home/redis/cluster/7001/redis.conf /home/redis/cluster/7006
        依次对应修改先关的配置文件

    修改完成后，在主节点的上尝试启动两个端口
    
    构建整个集群，搭建的时候是这样操作的：在任何一台机器上执行
    命令： cd  /usr/local/bin
    命令： ./redis-cli -a zhyredis --cluster  create 192.168.0.80:7001 192.168.0.80:7004 192.168.0.81:7002 192.168.0.81:7005 192.168.0.82:7003 192.168.0.82:7006  --cluster-replicas 1

    执行完成显示以下显示情况
    -------------------------------------------------------------
    Master[0] -&gt; Slots 0 - 5460
    Master[1] -&gt; Slots 5461 - 10922
    Master[2] -&gt; Slots 10923 - 16383
    Adding replica 192.168.0.81:7005 to 192.168.0.80:7001
    Adding replica 192.168.0.82:7006 to 192.168.0.81:7002
    Adding replica 192.168.0.80:7004 to 192.168.0.82:7003
    M: 18eca664e00b60a73c3d2977d36500ae9cc9ab86 192.168.0.80:7001
    slots:[0-5460] (5461 slots) master
    S: 7578e23f089aa129cb07ad481b1722e795b71c77 192.168.0.80:7004
    replicates 64d4e95451315bea3380655e62589a0d83f32af3
    M: 4fb53d266ab79e287f025508de0848afbf83709c 192.168.0.81:7002
    slots:[5461-10922] (5462 slots) master
    S: 57aa5e275df71287e97e858b5247fe8414bdc3fa 192.168.0.81:7005
    replicates 18eca664e00b60a73c3d2977d36500ae9cc9ab86
    M: 64d4e95451315bea3380655e62589a0d83f32af3 192.168.0.82:7003
    slots:[10923-16383] (5461 slots) master
    S: e0d814b7173b046608329cc3b9dc22058fc7dbd1 192.168.0.82:7006
    replicates 4fb53d266ab79e287f025508de0848afbf83709c
    Can I set the above configuration? (type &#39;yes&#39; to accept): yes
    &gt;&gt;&gt; Nodes configuration updated
    &gt;&gt;&gt; Assign a different config epoch to each node
    &gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
    Waiting for the cluster to join
    ..
    &gt;&gt;&gt; Performing Cluster Check (using node 192.168.0.80:7001)
    M: 18eca664e00b60a73c3d2977d36500ae9cc9ab86 192.168.0.80:7001
    slots:[0-5460] (5461 slots) master
    1 additional replica(s)
    M: 4fb53d266ab79e287f025508de0848afbf83709c 192.168.0.81:7002
    slots:[5461-10922] (5462 slots) master
    1 additional replica(s)
    S: 57aa5e275df71287e97e858b5247fe8414bdc3fa 192.168.0.81:7005
    slots: (0 slots) slave
    replicates 18eca664e00b60a73c3d2977d36500ae9cc9ab86
    S: 7578e23f089aa129cb07ad481b1722e795b71c77 192.168.0.80:7004
    slots: (0 slots) slave
    replicates 64d4e95451315bea3380655e62589a0d83f32af3
    S: e0d814b7173b046608329cc3b9dc22058fc7dbd1 192.168.0.82:7006
    slots: (0 slots) slave
    replicates 4fb53d266ab79e287f025508de0848afbf83709c
    M: 64d4e95451315bea3380655e62589a0d83f32af3 192.168.0.82:7003
    slots:[10923-16383] (5461 slots) master
    1 additional replica(s)
    [OK] All nodes agree about slots configuration.
    &gt;&gt;&gt; Check for open slots...
    &gt;&gt;&gt; Check slots coverage...
    -------------------------------------------------------------

    进行集群连接
</code></pre>
<h3 id="2、实战及原理"><a href="#2、实战及原理" class="headerlink" title="2、实战及原理"></a>2、实战及原理</h3><h4 id="2-1、redis的目录结构及了解"><a href="#2-1、redis的目录结构及了解" class="headerlink" title="2.1、redis的目录结构及了解"></a>2.1、redis的目录结构及了解</h4><ul>
<li><p>安装之后启动命令在 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;redis 下<br><img src="/zhangyangibm/redis/0001.png" alt="Redis" title="Redis"><br>在这个文件夹下<br>启动命令：redis-server<br>单元测试：redis-benchmark<br>持久化文件1：redis-check-aof<br>持久化文件2：redis-check-rdb</p>
</li>
<li><p>文件的安装路径在 &#x2F;usr&#x2F;local&#x2F;redis&#x2F;redis-5.0.8 下，这里边包含了原装的redis文件<br>首先创建一个文件目录，myredis 位置 &#x2F;usr&#x2F;local&#x2F;redis&#x2F;myredis<br>copy文件redis-5.0.8下的redis.conf 到 myredis下，目的是文件备份</p>
</li>
<li><p>redis启动：<br>redis-server &#x2F;usr&#x2F;local&#x2F;redis&#x2F;myredis&#x2F;redis.conf<br>查看启动情况：<br>ps -ef|grep redis，查看到启动进程说明启动成功<br><img src="/zhangyangibm/redis/0002.png" alt="Redis" title="Redis"><br>查看启动路径</p>
</li>
</ul>
<p>127.0.0.1:6379&gt; config get dir</p>
<ol>
<li>“dir”</li>
<li>“&#x2F;usr&#x2F;local&#x2F;bin”</li>
</ol>
<ul>
<li><p>测试单元测试：在bin目录下直接执行 <strong>redis-benchmark</strong> 测试<br><img src="/zhangyangibm/redis/0003.png" alt="Redis" title="Redis"></p>
</li>
<li><p>启动之后，进入在redis 端口<strong>6379</strong><br>redis-cli -p 6379<br><img src="/zhangyangibm/redis/0004.png" alt="Redis" title="Redis"><br><img src="/zhangyangibm/redis/0006.png" alt="Redis" title="Redis"></p>
</li>
<li><p>redis在刚刚创建完成之后 默认的安装了16个库，在redis.conf文件下会看到<br><img src="/zhangyangibm/redis/0005.png" alt="Redis" title="Redis"><br>依据官方的说法数据库的下标是从0开始到15结束，redis的索引也是从0开始的</p>
</li>
<li><p>命令<br>1、切换数据库：例如进入6号库：select 7<br><img src="/zhangyangibm/redis/0007.png" alt="Redis" title="Redis"><br>2、查看当前数据库有多少key：DBSIZE<br><img src="/zhangyangibm/redis/0008.png" alt="Redis" title="Redis"><br>3、查看key的对应的值：keys *<br><img src="/zhangyangibm/redis/0009.png" alt="Redis" title="Redis"><br>具体的值：keys 【key值】<br><img src="/zhangyangibm/redis/0010.png" alt="Redis" title="Redis"><br>模糊的值：keys 【key】使用*<br><img src="/zhangyangibm/redis/0011.png" alt="Redis" title="Redis"><br>4、清除：<br>清所有库所有的值：FLUSHALL<br><img src="/zhangyangibm/redis/0012.png" alt="Redis" title="Redis"><br><img src="/zhangyangibm/redis/0013.png" alt="Redis" title="Redis"><br>清当前库所有的值：FLUSHDB<br><img src="/zhangyangibm/redis/0014.png" alt="Redis" title="Redis"><br>5、判断key是否存在 EXISTS [key值] 存在返回1，不存在 0<br><img src="/zhangyangibm/redis/0015.png" alt="Redis" title="Redis"><br>6、数据移动命令 move [key值] [DB目标数据库]   例如将 k2移动到3号数据库<br>返回值：成功1 失败0，移走的值就不会在当前中出现<br><img src="/zhangyangibm/redis/0016.png" alt="Redis" title="Redis"><br>7、查看key的声明周期：<br>查看：ttl [key值] “-1”表示永不过期，“-2”表示已经过期<br><img src="/zhangyangibm/redis/0017.png" alt="Redis" title="Redis"><br>设定存活时间： EXPIRE [key值] [存活时间]。EXPIRE k1 20 给k1 20秒的存活时间<br><img src="/zhangyangibm/redis/0018.png" alt="Redis" title="Redis"></p>
</li>
</ul>
<p><strong>过期的key 将会被从内存中清除</strong><br>8、已经存在的key值，当出现重复的key的时候，原有的内容被覆盖<br><img src="/zhangyangibm/redis/0019.png" alt="Redis" title="Redis"><br>9、查看key的数据类型 TYPE [key值]<br><img src="/zhangyangibm/redis/0020.png" alt="Redis" title="Redis"></p>
<h4 id="2-2、redis的数据类型"><a href="#2-2、redis的数据类型" class="headerlink" title="2.2、redis的数据类型"></a>2.2、redis的数据类型</h4><p>redis官网介绍ta有五个数据类型：String List Hash Set Zset</p>
<ul>
<li><p>String<br>String类型是redis的最基本数据类型，使用的是k v键值对的模式，string类型是二进制安全的，String类型可以包含任何数据类型，一个String的存储最大值512Ms<br>特点：一个key对应一个值<br>1、删除DEL。DEL [key值]<br><img src="/zhangyangibm/redis/0021.png" alt="Redis" title="Redis"><br>2、追加APPEND 。APPEND [key值] [追加值] ，字符串长度STRLEN。 STRLEN [key值]<br><img src="/zhangyangibm/redis/0022.png" alt="Redis" title="Redis"><br>3、值递增INCR 。INCR [key值] [递增值],默认每执行一次value值自动+1<br><img src="/zhangyangibm/redis/0023.png" alt="Redis" title="Redis"><br>也支持多次递增<br><img src="/zhangyangibm/redis/0025.png" alt="Redis" title="Redis"><br>4、值递减DECR 。DECR [key值] [递减值],默认每执行一次value值自动-1<br><img src="/zhangyangibm/redis/0024.png" alt="Redis" title="Redis"><br>也支持多次递减<br><img src="/zhangyangibm/redis/0026.png" alt="Redis" title="Redis"><br>5、截取GETRANGE。GETRANGE [key值] [起始] [终点]，<strong>左包含右不包含</strong><br><img src="/zhangyangibm/redis/0027.png" alt="Redis" title="Redis"><br>6、在指定位置替换值。SETRANGE k5 1 zhangyang；<br><img src="/zhangyangibm/redis/0028.png" alt="Redis" title="Redis"><br>7、在set值的时候设定过期时间。设定一个k6 时间10秒 过了10之后从内存中清除：SETEX k6 10 v6<br><img src="/zhangyangibm/redis/0029.png" alt="Redis" title="Redis"><br>8、在set值的时候如果是空的时候才设定值，否则不设定<br><img src="/zhangyangibm/redis/0030.png" alt="Redis" title="Redis"><br>9、批量设定值mset。 mset key value [key value …]<br><img src="/zhangyangibm/redis/0031.png" alt="Redis" title="Redis"><br>msetnx k5 v5 k6 v5 的情况。当条件满足的时候可以成功，但条件不成立的时候本次执行都不成功，k6无法插入<br><img src="/zhangyangibm/redis/0033.png" alt="Redis" title="Redis"><br>10、批量设定值mget。 mget key [key …]<br><img src="/zhangyangibm/redis/0032.png" alt="Redis" title="Redis"></p>
</li>
<li><p>List<br>redis列表是简单的字符串列表，按照插顺序排列，也可以添加一个元素到元素列表的头部和尾部，底层的实现实际是链表<br>特点：单值多value<br>1、添加一个List：LPUSH （左）， LPUSH key value [value …]<br>LPUSH lis001 v1 v2 v3 v4 v5<br><img src="/zhangyangibm/redis/0034.png" alt="Redis" title="Redis"><br>2、获取List的值： LRANGE key start stop<br>LRANGE lis001 0 -1 到序值<br><img src="/zhangyangibm/redis/0035.png" alt="Redis" title="Redis"><br>3、设定值：RPUSH key value [value …]<br>RPUSH list002 1 2 3 4 5 6<br><img src="/zhangyangibm/redis/0036.png" alt="Redis" title="Redis"><br>4、获取List的值：LRANGE key start stop<br>LRANGE lis002 0 -1 正序值<br>5、移除值：LPOP key<br>lpop lis001：左设值最后进先移除<br><img src="/zhangyangibm/redis/0037.png" alt="Redis" title="Redis"><br>lpop lis002：又设值最先进先移除<br>6、获取List中某一个位置的值. LINDEX key index<br> LINDEX list002 2<br><img src="/zhangyangibm/redis/0038.png" alt="Redis" title="Redis"><br>7、长度：<br><img src="/zhangyangibm/redis/0039.png" alt="Redis" title="Redis"><br>8、删除：LREM key count value<br><img src="/zhangyangibm/redis/0040.png" alt="Redis" title="Redis"><br>删除两个8：LREM list003 2 8<br><img src="/zhangyangibm/redis/0041.png" alt="Redis" title="Redis"><br>9、截取值，所谓截取值是将截取之后的结果<strong>重新放在当前</strong>这个list中<br><img src="/zhangyangibm/redis/0042.png" alt="Redis" title="Redis"><br>10、RPOPLPUSH source destination<br><img src="/zhangyangibm/redis/0043.png" alt="Redis" title="Redis"><br><img src="/zhangyangibm/redis/0044.png" alt="Redis" title="Redis"><br>从第一个目标的底部移除，给入到两一个list的第一位<br>10、指定位置替换值 lset key index value<br>替换指定list 指定下标上的值<br><img src="/zhangyangibm/redis/0045.png" alt="Redis" title="Redis"><br><img src="/zhangyangibm/redis/0046.png" alt="Redis" title="Redis"><br>11、在指定的位置插入值  LINSERT key BEFORE|AFTER pivot value<br>在指定的值value之前&#x2F;之后插入值，这个值可以是多个<br><img src="/zhangyangibm/redis/0047.png" alt="Redis" title="Redis"></p>
</li>
<li><p>Set<br>无序无重复<br>1、添加值sadd  sadd key member [member …]</p>
</li>
</ul>
<p>127.0.0.1:6379&gt; sadd set01 1 1 2 3 4 5 6 6 6<br>(integer) 6<br>127.0.0.1:6379&gt;<br>实现重复的值被过滤了</p>
<p>2、查询所有的值 SMEMBERS key<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“1”</li>
<li>“2”</li>
<li>“3”</li>
<li>“4”</li>
<li>“5”</li>
<li>“6”</li>
</ol>
<p>127.0.0.1:6379&gt;<br>3、检索是否存在某一个值：SISMEMBER key member 存在返回1 不存在返回0<br>127.0.0.1:6379&gt; SISMEMBER set01 1<br>(integer) 1<br>127.0.0.1:6379&gt; SISMEMBER set01 10<br>(integer) 0<br>127.0.0.1:6379&gt;<br>4、获取set中有几个元素。SCARD key<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“1”</li>
<li>“2”</li>
<li>“3”</li>
<li>“4”</li>
<li>“5”</li>
<li>“6”</li>
<li>“7”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SCARD set01<br>(integer) 9<br>5、删除元素。SREM key member [member …]</p>
<ol>
<li>“1”</li>
<li>“2”</li>
<li>“5”</li>
<li>“6”</li>
<li>“7”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SREM set01 2<br>(integer) 1<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“1”</li>
<li>“5”</li>
<li>“6”</li>
<li>“7”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt;<br><img src="/zhangyangibm/redis/0048.png" alt="Redis" title="Redis"><br>6、随机查询数据。SRANDMEMBER key [count]<br>127.0.0.1:6379&gt; SRANDMEMBER set01 3</p>
<ol>
<li>“1”</li>
<li>“6”</li>
<li>“7”</li>
</ol>
<p>127.0.0.1:6379&gt;<br><img src="/zhangyangibm/redis/0049.png" alt="Redis" title="Redis"><br>7、随机出栈。spop key [count]<br>127.0.0.1:6379&gt; spop set01 2</p>
<ol>
<li>“9”</li>
<li>“6”<br><img src="/zhangyangibm/redis/0050.png" alt="Redis" title="Redis"><br>8、smove source destination member，<br>SMOVE set01 set02 1 在key01中某个值，作用是将key01的某个值赋给key02，key01移除</li>
</ol>
<p>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“1”</li>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; sadd set02 0 1 5 9 8<br>(integer) 5<br>127.0.0.1:6379&gt; SMEMBERS set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SMOVE set01 set02 1<br>(integer) 1<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; SMEMBERS set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt;<br><img src="/zhangyangibm/redis/0051.png" alt="Redis" title="Redis"><br>9、集合<br>差集：adiff<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; SMEMBERS set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SDIFF set01 set02</p>
<ol>
<li>“7”</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<p>set01在set02中没有 “7”<br><img src="/zhangyangibm/redis/0052.png" alt="Redis" title="Redis"></p>
<p>交集：sinter<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; SMEMBERS set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SINTER set01 set02</p>
<ol>
<li>“5”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt;<br>set01和set02共有的 “5”和”8”<br><img src="/zhangyangibm/redis/0053.png" alt="Redis" title="Redis"></p>
<p>并集：sunion<br>127.0.0.1:6379&gt; SMEMBERS set01</p>
<ol>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; SMEMBERS set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt; SINTER set01 set02</p>
<ol>
<li>“5”</li>
<li>“8”</li>
</ol>
<p>127.0.0.1:6379&gt; SUNION set01 set02</p>
<ol>
<li>“0”</li>
<li>“1”</li>
<li>“5”</li>
<li>“7”</li>
<li>“8”</li>
<li>“9”</li>
</ol>
<p>127.0.0.1:6379&gt;<br>set01和set02全部值<br><img src="/zhangyangibm/redis/0054.png" alt="Redis" title="Redis"></p>
<ul>
<li>Hash<br>类似于Map类型的集合，是一组键值对的集合，redis Hash是一个String类型的field和value的映射表，hash特别适用于存储对象<br>特点：k，v模式不变，v是一个键值对&lt;k,&lt;k,v&gt;&gt;<br>1、添加值：HSET key field value</li>
</ul>
<p>127.0.0.1:6379&gt; hset user ID 11<br>(integer) 1</p>
<p>127.0.0.1:6379&gt; Hset user01 id 01 name zhangsan age 30 school liaoningdaxue<br>(integer) 4<br>127.0.0.1:6379&gt; </p>
<p>2、取值：Hget key field<br>127.0.0.1:6379&gt; HGET user ID<br>“11”<br><img src="/zhangyangibm/redis/0055.png" alt="Redis" title="Redis"></p>
<p>3、连续添加多个值。 HMSET key field value [field value …]<br>127.0.0.1:6379&gt; hmset user02 id 02 name lisi age 24 school jilindaxue<br>OK</p>
<p>4、连续获取多个值。<br>方式1:HMGET key field [field …]<br>127.0.0.1:6379&gt; HMGET user02 id name age school</p>
<ol>
<li>“02”</li>
<li>“lisi”</li>
<li>“24”</li>
<li>“jilindaxue”</li>
</ol>
<p>127.0.0.1:6379&gt;<br><img src="/zhangyangibm/redis/0056.png" alt="Redis" title="Redis"></p>
<p>方式2:HGETALL key<br>127.0.0.1:6379&gt; HGETALL user02</p>
<ol>
<li>“id”</li>
<li>“02”</li>
<li>“name”</li>
<li>“lisi”</li>
<li>“age”</li>
<li>“24”</li>
<li>“school”</li>
<li>“jilindaxue”</li>
</ol>
<p>127.0.0.1:6379&gt;<br><img src="/zhangyangibm/redis/0057.png" alt="Redis" title="Redis"></p>
<p>5、获取长度。HLEN key<br>127.0.0.1:6379&gt; HLEN user01<br>(integer) 4<br><img src="/zhangyangibm/redis/0058.png" alt="Redis" title="Redis"></p>
<p>6、存在情况判断：HEXISTS key field ，1-有值，0-无值<br>127.0.0.1:6379&gt; HEXISTS user01 id<br>(integer) 1<br>127.0.0.1:6379&gt; HEXISTS user03 id<br>(integer) 0<br>127.0.0.1:6379&gt; HEXISTS user01 per<br>(integer) 0<br><img src="/zhangyangibm/redis/0059.png" alt="Redis" title="Redis"></p>
<p>7、获取所有key的值。HKEYS key<br>127.0.0.1:6379&gt; HKEYS user01</p>
<ol>
<li>“id”</li>
<li>“name”</li>
<li>“age”</li>
<li>“school”</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<p>8、获取所有value的值。HVALS key<br>127.0.0.1:6379&gt; HVALS user01</p>
<ol>
<li>“01”</li>
<li>“zhangsan”</li>
<li>“30”</li>
<li>“liaoningdaxue”</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<p>9、修改指定位置的值。HINCRBY key field increment<br>修改user01的年龄<br>127.0.0.1:6379&gt; HINCRBY user01 age 2<br>(integer) 32<br>127.0.0.1:6379&gt;<br>127.0.0.1:6379&gt; HVALS user01</p>
<ol>
<li>“01”</li>
<li>“zhangsan”</li>
<li>“32”</li>
<li>“liaoningdaxue”</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<ul>
<li>Zset<br>String元素的集合，且不许重复，不同之处在于zset每个元素都会有关联一个double类型的分数，redis是根据分数为集合中的成员进行从大到小排序的，zset的成员是唯一的但是分数却不可以重复。<br>就是在set的基础之上加一个score值，之前的set是k1 v2 v3 v4<br>现在Zset就是 k1 score1 v1，score2 v2<br>1、添加值ZADD。zadd key [NX|XX] [CH] [INCR] score member [score member …]</li>
</ul>
<p>127.0.0.1:6379&gt; zadd usertable 60 v1 70 v2 80 v3 90 v4 100 v5<br>(integer) 4</p>
<p>2、获取值。ZRANGE key start stop [WITHSCORES]<br>方式1:<br>127.0.0.1:6379&gt; ZRANGE usertable 0 -1</p>
<ol>
<li>“v1”</li>
<li>“v2”</li>
<li>“v3”</li>
<li>“v4”</li>
<li>“v5”<br>方式2:</li>
</ol>
<p>127.0.0.1:6379&gt; ZRANGE usertable 0 -1 WITHSCORES</p>
<ol>
<li>“v1”</li>
<li>“60”</li>
<li>“v2”</li>
<li>“70”</li>
<li>“v3”</li>
<li>“80”</li>
<li>“v4”</li>
<li>“90”</li>
<li>“v5”</li>
<li>“100”<br>方式3:<br>3、根据条件获取值。ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</li>
</ol>
<p>127.0.0.1:6379&gt; ZRANGEBYSCORE usertable 60 90 WIthscores,获取usertable中value值 &gt;&#x3D; 60 &lt;&#x3D;90的信息</p>
<ol>
<li>“v1”</li>
<li>“60”</li>
<li>“v2”</li>
<li>“70”</li>
<li>“v3”</li>
<li>“80”</li>
<li>“v4”</li>
<li>“90”<br><img src="/zhangyangibm/redis/0060.png" alt="Redis" title="Redis"><br>方式4:</li>
</ol>
<p>127.0.0.1:6379&gt; ZRANGEBYSCORE usertable 60 **(**90 WIthscores,获取usertable中value值  &gt;&#x3D; 60 &lt;90的信息</p>
<ol>
<li>“v1”</li>
<li>“60”</li>
<li>“v2”</li>
<li>“70”</li>
<li>“v3”</li>
<li>“80”<br>方式5:</li>
</ol>
<p>127.0.0.1:6379&gt; ZRANGEBYSCORE usertable 60 90 <strong>limit</strong> 2 1</p>
<ol>
<li>“v3”</li>
</ol>
<p>127.0.0.1:6379&gt; ZRANGEBYSCORE usertable 60 90 limit 2 2 </p>
<ol>
<li>“v3”</li>
<li>“v4”<br>方式6:根据key获取value</li>
</ol>
<p>127.0.0.1:6379&gt; ZSCORE usertable v3<br>“80”<br>127.0.0.1:6379&gt;</p>
<p>4、删除。ZREM key member [member …]<br>127.0.0.1:6379&gt; ZREM usertable v5，移除值&#x3D;v5<br>(integer) 1<br>127.0.0.1:6379&gt; ZRANGE usertable 0 -1</p>
<ol>
<li>“v1”</li>
<li>“v2”</li>
<li>“v3”</li>
<li>“v4”</li>
</ol>
<p>5、统计个数<br>方式1:统计记录的个数<br>127.0.0.1:6379&gt; ZRANGE usertable 0 -1</p>
<ol>
<li>“v1”</li>
<li>“v2”</li>
<li>“v3”</li>
<li>“v4”</li>
</ol>
<p>127.0.0.1:6379&gt; <strong>ZCARD</strong> usertable<br>(integer) 4</p>
<p>方式2:按照条件统计记录的个数<br>127.0.0.1:6379&gt; <strong>ZCOUNT</strong> usertable 60 80<br>(integer) 3<br>127.0.0.1:6379&gt; </p>
<p>6、排序。获取倒序<br>127.0.0.1:6379&gt; ZREVRANGE usertable 0 -1</p>
<ol>
<li>“v4”</li>
<li>“v3”</li>
<li>“v2”</li>
<li>“v1”</li>
</ol>
<p>获取结束分数到开始分数<br>127.0.0.1:6379&gt; ZREVRANGEBYSCORE usertable 90 60</p>
<ol>
<li>“v4”</li>
<li>“v3”</li>
<li>“v2”</li>
<li>“v1”</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<h4 id="2-3、redis的配置"><a href="#2-3、redis的配置" class="headerlink" title="2.3、redis的配置"></a>2.3、redis的配置</h4><p><img src="/zhangyangibm/redis/0061.png" alt="Redis" title="Redis"><br>redis的配置主要集中在 <strong>redis.conf</strong>文件中，因此从redis.conf文件下手。</p>
<ul>
<li><p>计量单位</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Note on units: when memory size is needed, it is possible to specify</span><br><span class="line"># it in the usual form of 1k 5GB 4M and so forth:</span><br><span class="line">#</span><br><span class="line"># 1k =&gt; 1000 bytes</span><br><span class="line"># 1kb =&gt; 1024 bytes</span><br><span class="line"># 1m =&gt; 1000000 bytes</span><br><span class="line"># 1mb =&gt; 1024*1024 bytes</span><br><span class="line"># 1g =&gt; 1000000000 bytes</span><br><span class="line"># 1gb =&gt; 1024*1024*1024 bytes</span><br><span class="line">#</span><br><span class="line"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span><br><span class="line"></span><br><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>配置信息<br>include &#x2F;path&#x2F;to&#x2F;local.conf</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">################################## INCLUDES ###################################</span><br><span class="line"></span><br><span class="line"># Include one or more other config files here.  This is useful if you</span><br><span class="line"># have a standard template that goes to all Redis servers but also need</span><br><span class="line"># to customize a few per-server settings.  Include files can include</span><br><span class="line"># other files, so use this wisely.</span><br><span class="line">#</span><br><span class="line"># Notice option &quot;include&quot; won&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span><br><span class="line"># from admin or Redis Sentinel. Since Redis always uses the last processed</span><br><span class="line"># line as value of a configuration directive, you&#x27;d better put includes</span><br><span class="line"># at the beginning of this file to avoid overwriting config change at runtime.</span><br><span class="line">#</span><br><span class="line"># If instead you are interested in using includes to override configuration</span><br><span class="line"># options, it is better to use include as the last line.</span><br><span class="line">#</span><br><span class="line"># include /path/to/local.conf</span><br><span class="line"># include /path/to/other.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>端口</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Accept connections on the specified port, default is 6379 (IANA #815344).</span><br><span class="line"># If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class="line">port 6379</span><br></pre></td></tr></table></figure></li>
<li><p>tcp-backlog 511<br>设置tcp的acklog</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># TCP listen() backlog.</span><br><span class="line">#</span><br><span class="line"># In high requests-per-second environments you need an high backlog in order</span><br><span class="line"># to avoid slow clients connections issues. Note that the Linux kernel</span><br><span class="line"># will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span><br><span class="line"># make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span><br><span class="line"># in order to get the desired effect.</span><br><span class="line">tcp-backlog 511</span><br></pre></td></tr></table></figure></li>
<li><p>timeout<br>在实际开发中，为了减轻服务器负担，当访问量不是很高的时候可以设定一个时间，让redis休息，默认是0，无中断时间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Close the connection after a client is idle for N seconds (0 to disable)</span><br><span class="line">timeout 0</span><br></pre></td></tr></table></figure></li>
<li><p>TCP keepalive.保持联系</p>
</li>
<li><p>日志级别</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Specify the server verbosity level.</span><br><span class="line"># This can be one of:</span><br><span class="line"># debug (a lot of information, useful for development/testing)</span><br><span class="line"># verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="line"># notice (moderately verbose, what you want in production probably)</span><br><span class="line"># warning (only very important / critical messages are logged)</span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"># output for logging but daemonize, logs will be sent to /dev/null</span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"># syslog-enabled no</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>redis有四个日志的级别：从低到高<br>debug:会打印生成大量信息，适用于开发&#x2F;测试阶段<br>verbose:包含很多不太有用的信息，但是不像debug级别那么混乱<br>notice:适度冗长，适用于生产环境<br>warning:仅记录非常重要、关键的警告消息</p>
<p>系统日志默认关闭，启动yes后需要配置日志的路径</p>
<ul>
<li><p>数据库默认个数 databases 16</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Set the number of databases. The default database is DB 0, you can select</span><br><span class="line"># a different one on a per-connection basis using SELECT <span class="tag">&lt;<span class="name">dbid</span>&gt;</span> where</span><br><span class="line"># dbid is a number between 0 and &#x27;databases&#x27;-1</span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure></li>
<li><p>持久化配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save <span class="tag">&lt;<span class="name">seconds</span>&gt;</span> <span class="tag">&lt;<span class="name">changes</span>&gt;</span></span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br></pre></td></tr></table></figure></li>
<li><p>安全</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">################################## SECURITY ###################################</span><br></pre></td></tr></table></figure>
<p>redis支持设定密码</p>
</li>
<li><p>限制CLIENTS</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">################################### CLIENTS ####################################</span><br><span class="line"></span><br><span class="line"># Set the max number of connected clients at the same time. By default</span><br><span class="line"># this limit is set to 10000 clients, however if the Redis server is not</span><br><span class="line"># able to configure the process file limit to allow for the specified limit</span><br><span class="line"># the max number of allowed clients is set to the current file limit</span><br><span class="line"># minus 32 (as Redis reserves a few file descriptors for internal uses).</span><br><span class="line">#</span><br><span class="line"># Once the limit is reached Redis will close all the new connections sending</span><br><span class="line"># an error &#x27;max number of clients reached&#x27;.</span><br><span class="line">#</span><br><span class="line"># maxclients 10000</span><br></pre></td></tr></table></figure>
<p>redis默认支持10000链接</p>
</li>
<li><p>过期策略配置<br>当缓存量很大的时候，redis提供了五种策略，默认永不过期noeviction：<br>volatile-lru -&gt;最近最少使用，这是针对过期的值。<br>allkeys-lru -&gt;最近最少使用。<br>volatile-lfu -&gt;在过期集的键中使用近似的LFU进行回收。<br>allkeys-lfu -&gt;使用近似的LFU清除任何键。<br>volatile-random -&gt; 删除一个随机键与过期设置。<br>allkeys-random -&gt; 删除一个随机键，任何键。<br>volatile-ttl -&gt; 有限时间内<br>noeviction -&gt; 永不过期</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># volatile-lru -&gt; Evict using approximated LRU among the keys with an expire set.</span><br><span class="line"># allkeys-lru -&gt; Evict any key using approximated LRU.</span><br><span class="line"># volatile-lfu -&gt; Evict using approximated LFU among the keys with an expire set.</span><br><span class="line"># allkeys-lfu -&gt; Evict any key using approximated LFU.</span><br><span class="line"># volatile-random -&gt; Remove a random key among the ones with an expire set.</span><br><span class="line"># allkeys-random -&gt; Remove a random key, any key.</span><br><span class="line"># volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span><br><span class="line"># noeviction -&gt; Don&#x27;t evict anything, just return an error on write operations.</span><br><span class="line">#</span><br><span class="line"># LRU means Least Recently Used</span><br><span class="line"># LFU means Least Frequently Used</span><br><span class="line">#</span><br><span class="line"># Both LRU, LFU and volatile-ttl are implemented using approximated</span><br><span class="line"># randomized algorithms.</span><br><span class="line">#</span><br><span class="line"># Note: with any of the above policies, Redis will return an error on write</span><br><span class="line">#       operations, when there are no suitable keys for eviction.</span><br><span class="line">#</span><br><span class="line">#       At the date of writing these commands are: set setnx setex append</span><br><span class="line">#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span><br><span class="line">#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span><br><span class="line">#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span><br><span class="line">#       getset mset msetnx exec sort</span><br><span class="line">#</span><br><span class="line"># The default is:</span><br><span class="line">#</span><br><span class="line"># maxmemory-policy noeviction</span><br></pre></td></tr></table></figure>

<h4 id="2-4、redis持久化"><a href="#2-4、redis持久化" class="headerlink" title="2.4、redis持久化"></a>2.4、redis持久化</h4><p>redis持久化两个部分 RDB和AOF</p>
<h5 id="2-4-1、RDB"><a href="#2-4-1、RDB" class="headerlink" title="2.4.1、RDB"></a>2.4.1、RDB</h5><p>持久化方式：<br>在指定的时间间隔内将内存中存储的数据集快快照写入磁盘，就是将SnapShot快照（dump.rdb）,在回复时直接将快照文件读写进内存。<br>如果对数据的恢复要快，由于在时间间隔内可能存在丢包的情况，如果对精度的要求不高，首选RDB。</p>
<p>fork的最用是复制一个于当前进程一样的进程，进的新城的所有数据、数值都于之前一摸一样，但是是一个全新的进程，并作为愿进程的子进程。</p>
<p>配置方式：<br>找到redis.conf,会有这样一段配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">################################ SNAPSHOTTING  ################################</span><br><span class="line">#</span><br><span class="line"># Save the DB on disk:</span><br><span class="line">#</span><br><span class="line">#   save <span class="tag">&lt;<span class="name">seconds</span>&gt;</span> <span class="tag">&lt;<span class="name">changes</span>&gt;</span></span><br><span class="line">#</span><br><span class="line">#   Will save the DB if both the given number of seconds and the given</span><br><span class="line">#   number of write operations against the DB occurred.</span><br><span class="line">#</span><br><span class="line">#   In the example below the behaviour will be to save:</span><br><span class="line">#   after 900 sec (15 min) if at least 1 key changed</span><br><span class="line">#   after 300 sec (5 min) if at least 10 keys changed</span><br><span class="line">#   after 60 sec if at least 10000 keys changed</span><br><span class="line">#</span><br><span class="line">#   Note: you can disable saving completely by commenting out all &quot;save&quot; lines.</span><br><span class="line">#</span><br><span class="line">#   It is also possible to remove all the previously configured save</span><br><span class="line">#   points by adding a save directive with a single empty string argument</span><br><span class="line">#   like in the following example:</span><br><span class="line">#</span><br><span class="line">#   save &quot;&quot;</span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>保存策略<br><strong>save 900</strong> 1：900秒redis中如果有一个key被修改了<br><strong>save 300</strong> 10：300秒内对key至少改过10次<br><strong>save 60 10000</strong>：60秒以内有一万次的变更<br>以上情况如果出现一次就会触发RDB</p>
<p>实验的情况配置save 120秒为例：<br><img src="/zhangyangibm/redis/0062.png" alt="Redis" title="Redis"></p>
<p>启动redis，</p>
<p>查看文件启动路径在<br>127.0.0.1:6379&gt; config get dir</p>
<ol>
<li>“dir”</li>
<li>“&#x2F;usr&#x2F;local&#x2F;redis&#x2F;myredis”</li>
</ol>
<p>如果当前的目录下存在dump.rdb文件，rm -rf 删除；</p>
<p>此时快速的执行插入11个值<br><img src="/zhangyangibm/redis/0063.png" alt="Redis" title="Redis"></p>
<p>等待2分钟，会发现在&#x2F;usr&#x2F;local&#x2F;redis&#x2F;myredis下从新生成一个dump.rdb</p>
<p>此时shutdown停止redis，再重新启动，执行keys * 查看：<br><img src="/zhangyangibm/redis/0064.png" alt="Redis" title="Redis"></p>
<p><strong>注意</strong> 如果在停止之前执行了 127.0.0.1:6379&gt; FLUSHALL<br>因为数据手动被删除，dump.rdb下边保存的文件是空的，所以 <strong>FLUSHALL</strong> 谨慎使用！</p>
<p>如果在2分钟内还是达不到备份的目的，可以使用以下的方法：<br>127.0.0.1:6379&gt; set k13 v13<br>OK<br>127.0.0.1:6379&gt; save<br>OK<br>127.0.0.1:6379&gt;<br>执行完成之后马上要在执行save</p>
<p>在异常的情况下，对异常的处理办法，需要在redis.conf配置，<strong>stop-writes-on-bgsave-error yes</strong>，当出现异常的情况下停止写，默认是yes，当然如果忽略异常则修改为“no”<br><img src="/zhangyangibm/redis/0065.png" alt="Redis" title="Redis"></p>
<p>RDB的流程：<br>redis使用期间文件会正常保存在内存中，此时如果按照redis的规则（900-1，300-10，10-10000），可以实现内存在硬盘的备份，文件是dump.rdb<br>如果redis被shutDown了，当重启启动的时候，redis会重新将dump.rdb文件读会到内存中，这个流程就实现了数据的备份<br>优点和缺点：<br>对大数据情况下，使用rdb备份比较方便快捷速度快，当时由于会收到时间差的影响，备份的不数据有可能不及时，导致文件丢失。</p>
<h5 id="2-4-1、AOF"><a href="#2-4-1、AOF" class="headerlink" title="2.4.1、AOF"></a>2.4.1、AOF</h5><p>持久化策略：AOF保存的是执行的语句，是将执行的<strong>write</strong>操作记录下来，等待数据恢复的时候，再重新读一遍脚本，执行以下命令，达到数据恢复的目的。</p>
<p>配置文件找到APPEND</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">############################## APPEND ONLY MODE ###############################</span><br><span class="line"># By default Redis asynchronously dumps the dataset on disk. This mode is</span><br><span class="line"># good enough in many applications, but an issue with the Redis process or</span><br><span class="line"># a power outage may result into a few minutes of writes lost (depending on</span><br><span class="line"># the configured save points).</span><br><span class="line">#</span><br><span class="line"># The Append Only File is an alternative persistence mode that provides</span><br><span class="line"># much better durability. For instance using the default data fsync policy</span><br><span class="line"># (see later in the config file) Redis can lose just one second of writes in a</span><br><span class="line"># dramatic event like a server power outage, or a single write if something</span><br><span class="line"># wrong with the Redis process itself happens, but the operating system is</span><br><span class="line"># still running correctly.</span><br><span class="line">#</span><br><span class="line"># AOF and RDB persistence can be enabled at the same time without problems.</span><br><span class="line"># If the AOF is enabled on startup Redis will load the AOF, that is the file</span><br><span class="line"># with the better durability guarantees.</span><br><span class="line">#</span><br><span class="line"># Please check http://redis.io/topics/persistence for more information.</span><br><span class="line"></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"># The fsync() call tells the Operating System to actually write data on disk</span><br><span class="line"># instead of waiting for more data in the output buffer. Some OS will really flush</span><br><span class="line"># data on disk, some other OS will just try to do it ASAP.</span><br><span class="line">#</span><br><span class="line"># Redis supports three different modes:</span><br><span class="line">                                                                 </span><br></pre></td></tr></table></figure>
<p>默认情况下：appendonly no 说明redis的AOF功能是关闭的,开启功能 改为yes<br><img src="/zhangyangibm/redis/0066.png" alt="Redis" title="Redis"><br><img src="/zhangyangibm/redis/0067.png" alt="Redis" title="Redis"></p>
<p>启动redis ，redis-server redis_aof.conf，马上查询redis启动目录，发现下边多了一个<strong>appendonly.aof</strong>文件<br><img src="/zhangyangibm/redis/0068.png" alt="Redis" title="Redis"></p>
<p>执行set命令：<br><img src="/zhangyangibm/redis/0070.png" alt="Redis" title="Redis"><br>关闭redis，redis关闭之前执行<strong>FLUSHALL</strong><br>cat appendonly.aof 查看刚刚写内容<br><img src="/zhangyangibm/redis/0069.png" alt="Redis" title="Redis"><br>当执行之后发现，FLUSHALL之后的文件恢复不了<br><img src="/zhangyangibm/redis/0071.png" alt="Redis" title="Redis"><br>修改ppendonly.aof文件，删除FLUSHALL语句之后，重新启动redis</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost myredis]# redis-cli  -p 6379</span><br><span class="line">127.0.0.1:6379&gt; keys * </span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k3&quot;</span><br><span class="line">3) &quot;k2&quot;</span><br><span class="line">4) &quot;k4&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/zhangyangibm/redis/0072.png" alt="Redis" title="Redis"></p>
<p>实现一种场景：数据恢复策略<br>手动将这个可恢复的ppendonly.aof做坏了，<br><img src="/zhangyangibm/redis/0073.png" alt="Redis" title="Redis"><br>此时文件有问题就不能恢复,redis无法正常启动<br><img src="/zhangyangibm/redis/0074.png" alt="Redis" title="Redis"><br>恢复策略：<br>1、获取到一个文件redis-check-aof<br> cp &#x2F;usr&#x2F;local&#x2F;bin&#x2F;redis-check-aof redis-check-aof<br>2、执行命令:<strong>redis-check-aof –fix appendonly.aof</strong><br><img src="/zhangyangibm/redis/0075.png" alt="Redis" title="Redis"><br>3、重新启动，显示恢复成功<br>redis-server redis_aof.conf<br>ps -ef|grep redis<br>redis-cli -p 6379<br><img src="/zhangyangibm/redis/0076.png" alt="Redis" title="Redis"></p>
<p><strong>总结：</strong><br>1、在redis环境中，RDB和AOF是可以共存的，同时存在的时候首先加载AOF，之后在家在RDB，<br>2、生产环境中，文件备份的精度要比AOF相对高（秒记录），但是AOF文件会因为数据过多导致文件过大（redis的默认 64兆），但是实际开发中应该配置&gt;3G<br><img src="/zhangyangibm/redis/0077.png" alt="Redis" title="Redis"></p>
<h4 id="2-5、redis的事务"><a href="#2-5、redis的事务" class="headerlink" title="2.5、redis的事务"></a>2.5、redis的事务</h4><p>可以一次执行多个命令，本质是一组命令的集合，一个事务中所有命令都会序列化，按照串行话执行而不会被其他命令插入，保持一致性。</p>
<ul>
<li>正常执行：<br>开启事务<strong>MULTI</strong><br>开启事务时候给出返回值ok，说明事务开启成功</li>
</ul>
<p>127.0.0.1:6379&gt; MULTI<br>OK<br>此时往redis中赋值，试行set k5 v5，redis将把请求放在队列（QUEUED）中<br>127.0.0.1:6379&gt; set key value [expiration EX seconds|PX milliseconds] [NX|XX]<br>127.0.0.1:6379&gt; set k5 v5<br>QUEUED<br>执行队列：<strong>EXEC</strong><br><img src="/zhangyangibm/redis/0078.png" alt="Redis" title="Redis"></p>
<ul>
<li>放弃事务：<br>开启事务</li>
</ul>
<p>127.0.0.1:6379&gt; MULTI<br>OK<br>设定值<br>127.0.0.1:6379&gt; set k8 v8<br>QUEUED<br>127.0.0.1:6379&gt; set k7 v77<br>QUEUED<br>放弃事务<strong>DISCARD</strong> 会发现设定值没有成功<br><img src="/zhangyangibm/redis/0079.png" alt="Redis" title="Redis"></p>
<ul>
<li>一损俱损</li>
</ul>
<p>127.0.0.1:6379&gt; MULTI<br>OK<br>127.0.0.1:6379&gt; set k8 v8<br>QUEUED<br>127.0.0.1:6379&gt; set k9 v9<br>QUEUED<br>127.0.0.1:6379&gt; seto k10 v10<br>(error) ERR unknown command <code>seto</code>, with args beginning with: <code>k10</code>, <code>v10</code>,<br>127.0.0.1:6379&gt;<br>当在执行过程中存在语法的所务，导致事务中断，此时事务没有处理全部中断</p>
<ul>
<li>各自为战<br><img src="/zhangyangibm/redis/0080.png" alt="Redis" title="Redis"><br>模拟环境，set两个值，在处理第三个值的时候要求对k1试行自增处理，但是自增的前提一定是类型是数字，当时k1对应的v1是String，因此无法实现update，但是由于前两个没有错误，会正常执行。<br>会发现其实所有的处理全部都加入了队列，非语法错误，最终的处理各自执行。</li>
</ul>
<p>127.0.0.1:6379&gt; EXEC</p>
<ol>
<li>OK</li>
<li>OK</li>
<li>(error) ERR value is not an integer or out of range</li>
</ol>
<p>127.0.0.1:6379&gt; </p>
<ul>
<li>监控watch<br>这里边有涉及到<strong>锁</strong>的概念<br>悲观锁：锁住整个表<br>乐观锁：锁住表的某个列或行<br>CAS</li>
</ul>
<p>案例1：<br>当前有一个k10,对应的值是1000<br>模拟两个线程<br>➡️线程一：对k10进行监控，并开启事务<br><img src="/zhangyangibm/redis/0081.png" alt="Redis" title="Redis"><br>➡️线程二：对k10的value值进行修改<br><img src="/zhangyangibm/redis/0082.png" alt="Redis" title="Redis"><br>➡️线程一：对k10也要进行修改<br><img src="/zhangyangibm/redis/0083.png" alt="Redis" title="Redis"><br>➡️线程一：事务提交<br><img src="/zhangyangibm/redis/0084.png" alt="Redis" title="Redis"><br>案例1结束：最终线程一没有能够成功对key10的值进行修改</p>
<p>案例2:unwatch,全程监控<br>当前有一个k10,对应的值是1000<br>模拟两个线程<br>➡️线程一：对k10进行全程监控unwatch，并开启事务<br><img src="/zhangyangibm/redis/0085.png" alt="Redis" title="Redis"><br>➡️线程二：对k10的value值进行修改-20<br><img src="/zhangyangibm/redis/0086.png" alt="Redis" title="Redis"><br>➡️线程一：对k10也要进行修改-10 再-200<br><img src="/zhangyangibm/redis/0087.png" alt="Redis" title="Redis"><br>➡️线程一：事务提交<br><img src="/zhangyangibm/redis/0088.png" alt="Redis" title="Redis"><br>案例2结束：顺利完成目标，就是说unwatch全程对k10的值进行的控制，监控者每个线程对他的操作，当中间线程对值优相关操作的时候，都会重新获取新的值，在进行处理。</p>
<h4 id="2-6、redis主从复制"><a href="#2-6、redis主从复制" class="headerlink" title="2.6、redis主从复制"></a>2.6、redis主从复制</h4><p>准备四台机器redis的端口分别是：6379，6380，6381，6382<br><img src="/zhangyangibm/redis/0089.png" alt="Redis" title="Redis"><br>配置完成之后启动</p>
<p>查看80、81、82三台机器的基本信息 三个一致都是master：role:master</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_replid:3401c0533af9d77d8b6acb563ac741b62ff05d64</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; </span><br></pre></td></tr></table></figure>
<p>80:设定值<br><img src="/zhangyangibm/redis/0090.png" alt="Redis" title="Redis"></p>
<p>从机设定主从命令：127.0.0.1:6382&gt; SLAVEOF host port<br><img src="/zhangyangibm/redis/0091.png" alt="Redis" title="Redis"><br>81:SLAVEOF 192.168.0.109 6380<br>82:SLAVEOF 192.168.0.109 6380<br><img src="/zhangyangibm/redis/0093.png" alt="Redis" title="Redis"><br>以上为止，主从配置完成！</p>
<ul>
<li><p>模拟情况1:<br>80主机从新开始设定值<br><img src="/zhangyangibm/redis/0092.png" alt="Redis" title="Redis"><br>81&#x2F;82从机上获取k4<br><img src="/zhangyangibm/redis/0094.png" alt="Redis" title="Redis"><br>此时说明完成主从复制的功能实现。</p>
</li>
<li><p>模拟情况2:<br>80主机执行了shutDown命令，之后退出redis，<br>观察从机81&#x2F;82的变化如何？首先81&#x2F;82机器上否是能获取到之前的备份的数据，其次两个机器的角色是什么？<br>测试结果1：</p>
</li>
</ul>
<p>127.0.0.1:6381&gt; get k4<br>v4<br>#———————–<br>127.0.0.1:6382&gt; get k4<br>v4</p>
<p>测试结果2：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_replid:3401c0533af9d77d8b6acb563ac741b62ff05d64</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; </span><br></pre></td></tr></table></figure>
<p>根据上边的测试结果得出结论：当主机执行shutDown后，从机的数据依旧保存，而且角色不变依旧是slave<br>反之此时主机启动，redis开始重新工作，主机（80）的角色不变依旧是master，81&#x2F;82依旧是slave，而且会继续保持主从关系。</p>
<ul>
<li>模拟情况3:<br>从机执行了shutDown命令，81之后退出redis。此时主机有注册了一个k6 v6，完事从机重新登陆redis，这个时候角色有什么变化？之前的数据如何变化？<br>测试结果：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">0</span></span><br><span class="line">master_replid:3401c0533af9d77d8b6acb563ac741b62ff05d64</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; get <span class="title function_">k6</span></span><br><span class="line"><span class="params">(nil)</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; </span><br></pre></td></tr></table></figure>
结论：在主从机构总，如果从机断开，当再重新链接后角色发生变化变成master，而且从机不再提供备份服务，除非文件配置在配置文件中。</li>
</ul>
<p><strong>备份总结：</strong><br><strong>首次备份全量备份</strong>，虽然是从k4开始的，但是k4之前的也是做了备份，但是从<strong>全量之后都是增量备份</strong>。</p>
<ul>
<li>模拟情况4:<br>配置三台机器：80master，81是80的从机，82是81的从机<br>此时主从关系是什么样的？备份关系是什么？<br>主机执行</li>
</ul>
<p>127.0.0.1:6380&gt; set k11 v11<br>OK<br>此时81和82<br>127.0.0.1:6381&gt; get k11<br>v11<br>127.0.0.1:6382&gt; get k11<br>v11</p>
<p>主机80点显示master，从节点显示1个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">master_replid:cc46c5b644597af1c1eef3bb9a5e98b8460d8621</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>从机81点显示slave，从节点显示1个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">27.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">master_replid:cc46c5b644597af1c1eef3bb9a5e98b8460d8621</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>总结：这样的模式称为 <strong>“去中心化”</strong>缓解单一节点的压力。</p>
<ul>
<li><p>模拟情况5:<br>配置三台机器：80master，81是80的从机，82是81的从机<br>此时当80master机器中断，剩余81和82正常运行，此时没有了主机，此时如果处理？<br>redis的主从关系中如果没有了主机，相当于瘫痪了，因此要重新定义主机，这就需要一个新的命令：127.0.0.1:6381&gt; <strong>SLAVEOF no one</strong>,需要告知集群此时没有主机，需要重新选择一个新的主机，作为master，这个主机是随机选择的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; **SLAVEOF no one**</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">master_replid:cc46c5b644597af1c1eef3bb9a5e98b8460d8621</span><br><span class="line">master_replid2:<span class="number">0000000000000000000000000000000000000000</span></span><br><span class="line">master_repl_offset:<span class="number">0</span></span><br><span class="line">second_repl_offset:-<span class="number">1</span></span><br><span class="line">repl_backlog_active:<span class="number">0</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">0</span></span><br><span class="line">repl_backlog_histlen:<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>但此时当在重新启动原来的主机80的时候，原来的主机就会称为另一个全新的master，不在与81和82有任何关系，这就是 <strong>“反客为主”</strong>。</p>
</li>
<li><p>模拟情况6:<br>配置三台机器：80master，81是80的从机，82是81的从机<br>还需要一个配置文件：sentinel.conf,翻译称为<strong>哨兵</strong>，这个sentinel.conf配置的作用是，监视主机的行动如果主机宕机，会自动在剩余的环境中选择新的机器作为主机称为master，而且会不断监控。此时如果原来的主机重新恢复，那个这台愿主机会成为从机。这样也就是 <strong>“哨兵模式”</strong>，这种模式很灵活但是存在一定的延时。<br><img src="/zhangyangibm/redis/0095.png" alt="Redis" title="Redis"><br>copy <strong>sentinel.conf</strong> 到启动目录下：<br><img src="/zhangyangibm/redis/0096.png" alt="Redis" title="Redis"><br>sentinel monitor host7379 192.168.0.xxx 6379 1<br><img src="/zhangyangibm/redis/0097.png" alt="Redis" title="Redis"></p>
</li>
</ul>
<h4 id="2-7、java与redis"><a href="#2-7、java与redis" class="headerlink" title="2.7、java与redis"></a>2.7、java与redis</h4><p>实际开发过程中需要在Java中调用和中用redis完成业务处理，主要步骤：<br>1、引入jar包，jedis</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、java代码的调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(jedis.ping());</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试结果<br><img src="/zhangyangibm/redis/0098.png" alt="Redis" title="Redis"></p>
<p>3、其他Api用法<br>set</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">		jedis.set(<span class="string">&quot;k12&quot;</span>,<span class="string">&quot;java12&quot;</span>);</span><br><span class="line">		jedis.set(<span class="string">&quot;k13&quot;</span>,<span class="string">&quot;java13&quot;</span>);</span><br><span class="line">		jedis.set(<span class="string">&quot;k14&quot;</span>,<span class="string">&quot;java14&quot;</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主机测试<br><img src="/zhangyangibm/redis/0099.png" alt="Redis" title="Redis"><br>从机显示<br><img src="/zhangyangibm/redis/0100.png" alt="Redis" title="Redis"></p>
<p>get</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">		System.out.println(jedis.get(<span class="string">&quot;k12&quot;</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/zhangyangibm/redis/0101.png" alt="Redis" title="Redis"><br>keys *<br><img src="/zhangyangibm/redis/0102.png" alt="Redis" title="Redis"></p>
<p>事务Transaction</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//事务</span></span><br><span class="line">		<span class="type">Transaction</span> <span class="variable">transaction</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">		transaction.set(<span class="string">&quot;k15&quot;</span>,<span class="string">&quot;w1&quot;</span>);</span><br><span class="line">		transaction.set(<span class="string">&quot;k16&quot;</span>,<span class="string">&quot;w1&quot;</span>);</span><br><span class="line">		transaction.set(<span class="string">&quot;k17&quot;</span>,<span class="string">&quot;w1&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//提交事务</span></span><br><span class="line">		transaction.exec();</span><br><span class="line">		<span class="comment">//放弃事务</span></span><br><span class="line">		<span class="comment">//transaction.discard();</span></span><br><span class="line">		<span class="comment">//监控</span></span><br><span class="line">		<span class="comment">//transaction.watch(&quot;k10&quot;);</span></span><br><span class="line">		<span class="comment">//transaction.unwatch();</span></span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主从复制</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis79</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis80</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.109&quot;</span>,<span class="number">6380</span>);</span><br><span class="line">    </span><br><span class="line">    jedis79.set(<span class="string">&quot;k20&quot;</span>,<span class="string">&quot;v20&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;jedis80......&quot;</span>+jedis80.get(<span class="string">&quot;k20&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;jedis80......&quot;</span>+jedis80.keys(<span class="string">&quot;k20&quot;</span>));</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>redis的池化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span> &#123;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool= <span class="literal">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">Redis</span><span class="params">()</span> &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title function_">getRedisInstance</span><span class="params">()</span> &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(<span class="literal">null</span> == jedisPool) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (Redis.class) &#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="literal">null</span> == jedisPool) &#123;</span><br><span class="line">					</span><br><span class="line">					<span class="comment">//redis配置</span></span><br><span class="line">					<span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">					jedisPoolConfig.setMaxIdle(<span class="number">1000</span>);</span><br><span class="line">					jedisPoolConfig.setMaxWaitMillis(<span class="number">100</span>*<span class="number">1000</span>);</span><br><span class="line">					jedisPoolConfig.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">					</span><br><span class="line">					jedisPool= <span class="keyword">new</span> <span class="title class_">JedisPool</span>(jedisPoolConfig,<span class="string">&quot;192.168.0.105&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> jedisPool;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">捕猹少年</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gitee.com/zhangyangibm/zhangyangibm.git/2020/07/24/redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">https://gitee.com/zhangyangibm/zhangyangibm.git/2020/07/24/redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gitee.com/zhangyangibm/zhangyangibm.git" target="_blank">Gordo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/zhangyangibm/tags/linux/">linux</a><a class="post-meta__tags" href="/zhangyangibm/tags/redis/">redis</a><a class="post-meta__tags" href="/zhangyangibm/tags/%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF/">缓存技术</a></div><div class="post_share"><div class="social-share" data-image="/zhangyangibm/img/redis.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/zhangyangibm/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/zhangyangibm/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/zhangyangibm/img/zhifubao.png" target="_blank"><img class="post-qr-code-img" src="/zhangyangibm/img/zhifubao.png" alt="zhifubao"/></a><div class="post-qr-code-desc">zhifubao</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/zhangyangibm/2020/12/10/%E6%B5%85%E8%B0%88Spring/"><img class="prev-cover" src="/zhangyangibm/img/spring.png" onerror="onerror=null;src='/zhangyangibm/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">浅谈spring</div></div></a></div><div class="next-post pull-right"><a href="/zhangyangibm/2020/07/23/webservice/"><img class="next-cover" src="/zhangyangibm/img/webservice.png" onerror="onerror=null;src='/zhangyangibm/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">webservice</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/zhangyangibm/2021/12/24/Docker%20for%20Linux/" title="Docker for Liunx"><img class="cover" src="/zhangyangibm/img/docker.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-24</div><div class="title">Docker for Liunx</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/zhangyangibm/img/header.jpg" onerror="this.onerror=null;this.src='/zhangyangibm/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">捕猹少年</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/zhangyangibm/archives/"><div class="headline">文章</div><div class="length-num">18</div></a></div><div class="card-info-data-item"><a href="/zhangyangibm/tags/"><div class="headline">标签</div><div class="length-num">37</div></a></div><div class="card-info-data-item"><a href="/zhangyangibm/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div></div><a id="card-info-btn" href="https://gitee.com/zhangyangibm/zhangyangibm"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:123456789gordo@sina.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">大家好，欢迎来到我的频道，<br>新频道从2022年正式Github迁移至Gitee，感谢您一如既往的关注和支持！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">1、安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1%E3%80%81%E5%B7%A5%E5%85%B7%E5%92%8C%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">1.1、工具和镜像文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2%E3%80%81%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">1.2、前期准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3%E3%80%81%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="toc-number">2.3.</span> <span class="toc-text">1.3、集群搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E6%88%98%E5%8F%8A%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">2、实战及原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E3%80%81redis%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%8F%8A%E4%BA%86%E8%A7%A3"><span class="toc-number">3.1.</span> <span class="toc-text">2.1、redis的目录结构及了解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2%E3%80%81redis%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">2.2、redis的数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3%E3%80%81redis%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">2.3、redis的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4%E3%80%81redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">3.4.</span> <span class="toc-text">2.4、redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1%E3%80%81RDB"><span class="toc-number">3.4.1.</span> <span class="toc-text">2.4.1、RDB</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1%E3%80%81AOF"><span class="toc-number">3.4.2.</span> <span class="toc-text">2.4.1、AOF</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5%E3%80%81redis%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.5.</span> <span class="toc-text">2.5、redis的事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6%E3%80%81redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">3.6.</span> <span class="toc-text">2.6、redis主从复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7%E3%80%81java%E4%B8%8Eredis"><span class="toc-number">3.7.</span> <span class="toc-text">2.7、java与redis</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/zhangyangibm/2022/04/01/mytatis%E7%BC%93%E5%AD%98/" title="mybatis缓存"><img src="/zhangyangibm/img/mybatis.png" onerror="this.onerror=null;this.src='/zhangyangibm/img/404.jpg'" alt="mybatis缓存"/></a><div class="content"><a class="title" href="/zhangyangibm/2022/04/01/mytatis%E7%BC%93%E5%AD%98/" title="mybatis缓存">mybatis缓存</a><time datetime="2022-04-01T05:30:00.000Z" title="发表于 2022-04-01 13:30:00">2022-04-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zhangyangibm/2022/03/29/%E5%8D%95%E4%BD%93%E4%BA%8B%E5%8A%A1/" title="单体事务"><img src="/zhangyangibm/img/trans1.png" onerror="this.onerror=null;this.src='/zhangyangibm/img/404.jpg'" alt="单体事务"/></a><div class="content"><a class="title" href="/zhangyangibm/2022/03/29/%E5%8D%95%E4%BD%93%E4%BA%8B%E5%8A%A1/" title="单体事务">单体事务</a><time datetime="2022-03-29T05:30:00.000Z" title="发表于 2022-03-29 13:30:00">2022-03-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zhangyangibm/2022/03/28/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式事务TCC"><img src="/zhangyangibm/img/fenbushi.png" onerror="this.onerror=null;this.src='/zhangyangibm/img/404.jpg'" alt="分布式事务TCC"/></a><div class="content"><a class="title" href="/zhangyangibm/2022/03/28/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1/" title="分布式事务TCC">分布式事务TCC</a><time datetime="2022-03-28T05:30:00.000Z" title="发表于 2022-03-28 13:30:00">2022-03-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zhangyangibm/2022/03/27/RabbitMq/" title="消息队列rabbitmq"><img src="/zhangyangibm/img/rabbitmq.png" onerror="this.onerror=null;this.src='/zhangyangibm/img/404.jpg'" alt="消息队列rabbitmq"/></a><div class="content"><a class="title" href="/zhangyangibm/2022/03/27/RabbitMq/" title="消息队列rabbitmq">消息队列rabbitmq</a><time datetime="2022-03-27T02:00:00.000Z" title="发表于 2022-03-27 10:00:00">2022-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/zhangyangibm/2021/12/24/Docker%20for%20Linux/" title="Docker for Liunx"><img src="/zhangyangibm/img/docker.png" onerror="this.onerror=null;this.src='/zhangyangibm/img/404.jpg'" alt="Docker for Liunx"/></a><div class="content"><a class="title" href="/zhangyangibm/2021/12/24/Docker%20for%20Linux/" title="Docker for Liunx">Docker for Liunx</a><time datetime="2021-12-24T14:49:47.000Z" title="发表于 2021-12-24 22:49:47">2021-12-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/zhangyangibm/img/top_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 捕猹少年</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to <a target="_blank" rel="noopener" href="https://zhangyangibm.gitee.io/">ZHY.Channel</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/zhangyangibm/js/utils.js"></script><script src="/zhangyangibm/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://gitee.com/zhangyangibm/zhangyangibm.git/2020/07/24/redis%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/'
    this.page.identifier = '2020/07/24/redis集群搭建/'
    this.page.title = 'redis集群'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>